<!DOCTYPE html>
<html>
    <head>
        <base href="">
        <style>
            html {
                font-size: 14px;
                font-family: Arial, Helvetica, sans-serif;
            }
        </style>
        <title></title>
        <link rel="stylesheet" href="../excel/kendo.common-material.min.css" />
        <link rel="stylesheet" href="../excel/kendo.material.min.css" />
        <link rel="stylesheet" href="../excel/kendo.material.mobile.min.css" />
        <script src="../excel/jquery.min.js"></script>
        <script src="../excel/jszip.min.js"></script>
        <script src="../excel/kendo.all.min.js"></script>
        <script>
            var scr = document.createElement('script');
            scr.onload = function() {
                display("Loaded: " + typeof ko);
            };
            scr.onerror = function() {
                display("Error");
            };
            scr.src = "../excel/knockout-3.2.0.js";
            document.querySelector("script").parentNode.appendChild(scr);

            function display(msg) {
                $("<p>").html(String(msg)).appendTo(document.body);
            }
        </script>

        <style>
            body{
                margin:0;
                overflow:hidden;
            }
            .k-spreadsheet .k-spreadsheet-cell-editor, .k-spreadsheet .k-spreadsheet-formula-input {
                font-size: 14px;
            }
        </style>
        <script>
            $( document ).ready(function() {
                const urlParams = new URLSearchParams(window.location.search);
                const rscoid = urlParams.get('rscoid');
                const q = urlParams.get('q');
                const B = urlParams.get('B');
                console.log("rscoid", rscoid, "q", q, "B", B);
                $('#spreadsheet').height($(window).height());
                if(B) {
                    loadBackupSpreadSheet(rscoid,q);
                } else {
                    loadSpreadSheet(rscoid,q);
                }
                $( window ).resize(function() {
                    $('#spreadsheet').height($(window).height());
                });
            });

            function loadSpreadSheet(rscoid,q){
                $('#loadinggif').hide();
                $(function() {
                    $("#spreadsheet").kendoSpreadsheet({
                        excel: {
                            proxyURL: "https://elearningpat.com/admin/patservices/service.php?q=Q"+ q +"&scoid=" + rscoid,
                            forceProxy: true,
                            fileName: "ExcelFromScorm.xlsx"
                        },
                        pdf: {
                            proxyURL: "https://elearningpat.com/admin/patservices/service.php?q=Q"+ q +"&scoid=" + rscoid,
                            forceProxy: true
                        },
                        defaultCellStyle: {
                            wrap: false,
                            fontSize: '14'
                        },
                        rowHeight: 23
                    });
                    var name = "spreadsheet" + q;
                    if(sessionStorage.getItem(name)){
                        console.log("check",name, sessionStorage.getItem(name))
                        var spreadsheet = $("#spreadsheet").data("kendoSpreadsheet");
                        var sheet_data = JSON.parse(sessionStorage.getItem(name));
                        spreadsheet.fromJSON({sheets: sheet_data.sheets});
                    }
                });
            }
            function loadBackupSpreadSheet(rscoid,q){
                $('#loadinggif').hide();
                $(function() {
                    $("#spreadsheet").kendoSpreadsheet({
                        excel: {
                            proxyURL: "https://elearningpat.com/admin/patservices/service.php?q=Q"+ q + "_Backup" +"&scoid=" + rscoid,
                            forceProxy: true,
                            fileName: "ExcelFromScorm.xlsx"
                        },
                        pdf: {
                            proxyURL: "https://elearningpat.com/admin/patservices/service.php?q=Q"+ q + "_Backup" +"&scoid=" + rscoid,
                            forceProxy: true
                        },
                        defaultCellStyle: {
                            wrap: false,
                            fontSize: '14'
                        },
                        rowHeight: 23
                    });
                    var name = "spreadsheet" + q;
                    if(sessionStorage.getItem(name)){
                        console.log("check",name, sessionStorage.getItem(name))
                        var spreadsheet = $("#spreadsheet").data("kendoSpreadsheet");
                        var sheet_data = JSON.parse(sessionStorage.getItem(name));
                        spreadsheet.fromJSON({sheets: sheet_data.sheets});
                    }
                });
            }

            function submitSpreadSheet(){
                var spreadsheet = $("#spreadsheet").data("kendoSpreadsheet");
                // var check = spreadsheet.toJSON();
                spreadsheet.saveAsPDF();
            }
        </script>
    </head>
    <body>
        <div id="example">
            <div id="spreadsheet" style="width: 100%;max-height:100%!important">
                <img id='loadinggif' src='../excel/images/loading.gif'/>
            </div>
        </div>
    </body>
</html>
